{% extends "base.html" %}

{% block title %}AI-Socratic-Clarifier - Dashboard{% endblock %}

{% block additional_css %}
<style>
    .feature-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        height: 100%;
    }
    
    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .feature-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
    }
    
    .quick-analyze {
        background-color: rgba(52, 152, 219, 0.1);
        border-radius: 10px;
        padding: 20px;
    }
    
    .activity-item {
        border-left: 3px solid var(--primary-color);
        padding-left: 15px;
        margin-bottom: 15px;
    }
    
    .document-card {
        display: flex;
        align-items: center;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 10px;
        background-color: rgba(0, 0, 0, 0.02);
        transition: background-color 0.2s ease;
    }
    
    .document-card:hover {
        background-color: rgba(0, 0, 0, 0.05);
    }
    
    .document-icon {
        font-size: 1.5rem;
        margin-right: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h1 class="mb-4">AI-Socratic-Clarifier</h1>
            <p class="lead">
                A tool for analyzing statements through a Socratic lens, detecting logical issues, and generating thoughtful questions to promote clearer thinking.
            </p>
        </div>
        <div class="col-md-4 text-md-end">
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button class="btn btn-primary" id="newSessionBtn">
                    <i class="bi bi-plus-circle"></i> New Session
                </button>
                <button class="btn btn-outline-secondary" id="importDocumentBtn">
                    <i class="bi bi-upload"></i> Import Document
                </button>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-lg-8">
            <!-- Quick Analysis Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-lightning-charge"></i> Quick Analysis
                </div>
                <div class="card-body">
                    <div class="quick-analyze">
                        <div class="form-group">
                            <textarea id="quickAnalysisText" class="form-control" rows="4" placeholder="Enter text to analyze..."></textarea>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <select id="quickAnalysisMode" class="form-select">
                                    <option value="standard">Standard Analysis</option>
                                    <option value="deep">Deep Inquiry</option>
                                    <option value="reflective">Reflective Ecosystem</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div class="d-grid">
                                    <button id="quickAnalysisBtn" class="btn btn-primary">
                                        <i class="bi bi-search"></i> Analyze
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results will appear here -->
                    <div id="quickResults" class="mt-4 d-none">
                        <div class="card">
                            <div class="card-header bg-light">
                                Analysis Results
                            </div>
                            <div class="card-body">
                                <h6>Detected Issues:</h6>
                                <div id="quickIssuesList" class="mb-3"></div>
                                
                                <h6>Socratic Questions:</h6>
                                <div id="quickQuestionsList" class="mb-3"></div>
                                
                                <div class="d-flex justify-content-between mt-4">
                                    <button id="sendToChatBtn" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-chat"></i> Continue in Chat
                                    </button>
                                    <button id="deeperAnalysisBtn" class="btn btn-sm btn-outline-secondary">
                                        <i class="bi bi-diagram-3"></i> Deeper Analysis
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Features Section -->
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card feature-card">
                        <div class="card-body text-center">
                            <div class="feature-icon text-primary">
                                <i class="bi bi-chat-dots"></i>
                            </div>
                            <h5 class="card-title">Socratic Chat</h5>
                            <p class="card-text">Engage in conversational analysis where the system responds with Socratic questions to promote deeper thinking.</p>
                            <a href="/chat" class="btn btn-primary">Open Chat</a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card feature-card">
                        <div class="card-body text-center">
                            <div class="feature-icon text-success">
                                <i class="bi bi-diagram-3"></i>
                            </div>
                            <h5 class="card-title">Reflective Ecosystem</h5>
                            <p class="card-text">Experience AI reflection through dynamic resonance fields with conceptual chaining and expert lexicons.</p>
                            <a href="/reflection" class="btn btn-secondary">Open Reflection</a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card feature-card">
                        <div class="card-body text-center">
                            <div class="feature-icon text-info">
                                <i class="bi bi-file-earmark-text"></i>
                            </div>
                            <h5 class="card-title">Document Analysis</h5>
                            <p class="card-text">Analyze documents and images with OCR and multimodal capabilities for comprehensive insights.</p>
                            <a href="/multimodal" class="btn btn-info text-white">Open Documents</a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card feature-card">
                        <div class="card-body text-center">
                            <div class="feature-icon text-danger">
                                <i class="bi bi-journals"></i>
                            </div>
                            <h5 class="card-title">Knowledge Library</h5>
                            <p class="card-text">Access and manage your document library for context-aware analysis and conversations.</p>
                            <a href="/library" class="btn btn-danger">Open Library</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Recent Activity Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-clock-history"></i> Recent Activity
                </div>
                <div class="card-body" id="recentActivities">
                    <!-- Activity items will be dynamically added here -->
                    <div class="activity-item">
                        <div class="d-flex justify-content-between">
                            <strong>Reflection Analysis</strong>
                            <small class="text-muted">5 min ago</small>
                        </div>
                        <p class="mb-0">Analyzed text with resonance of 0.85</p>
                    </div>
                    
                    <div class="activity-item">
                        <div class="d-flex justify-content-between">
                            <strong>Chat Session</strong>
                            <small class="text-muted">15 min ago</small>
                        </div>
                        <p class="mb-0">Discussed critical analysis methodology</p>
                    </div>
                    
                    <div class="activity-item">
                        <div class="d-flex justify-content-between">
                            <strong>Document Analysis</strong>
                            <small class="text-muted">1 hour ago</small>
                        </div>
                        <p class="mb-0">Processed research-paper.pdf</p>
                    </div>
                    
                    <div class="text-center mt-3">
                        <button class="btn btn-sm btn-outline-secondary" id="viewAllActivityBtn">
                            View All Activity
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Recent Documents Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <i class="bi bi-file-earmark"></i> Recent Documents
                </div>
                <div class="card-body">
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="bi bi-file-earmark-pdf text-danger"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between">
                                <strong>research-paper.pdf</strong>
                                <small class="text-muted">1.2 MB</small>
                            </div>
                            <small class="text-muted">Uploaded 1 hour ago</small>
                        </div>
                    </div>
                    
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="bi bi-file-earmark-image text-primary"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between">
                                <strong>diagram.png</strong>
                                <small class="text-muted">450 KB</small>
                            </div>
                            <small class="text-muted">Uploaded yesterday</small>
                        </div>
                    </div>
                    
                    <div class="document-card">
                        <div class="document-icon">
                            <i class="bi bi-file-earmark-text text-success"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between">
                                <strong>notes.txt</strong>
                                <small class="text-muted">15 KB</small>
                            </div>
                            <small class="text-muted">Uploaded 2 days ago</small>
                        </div>
                    </div>
                    
                    <div class="text-center mt-3">
                        <a href="/library" class="btn btn-sm btn-outline-secondary">
                            View All Documents
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- System Status Card -->
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-info-circle"></i> System Information
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Model:</span>
                        <span id="dashboardModelName">llama3</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Provider:</span>
                        <span id="dashboardProvider">ollama</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>SoT Enabled:</span>
                        <span id="dashboardSotStatus">Yes</span>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span>Document Library:</span>
                        <span id="dashboardDocumentCount">3 files</span>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <span>System Health:</span>
                        <span class="badge bg-success">Operational</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Quick Analysis
        const quickAnalysisBtn = document.getElementById('quickAnalysisBtn');
        const quickAnalysisText = document.getElementById('quickAnalysisText');
        const quickAnalysisMode = document.getElementById('quickAnalysisMode');
        const quickResults = document.getElementById('quickResults');
        const quickIssuesList = document.getElementById('quickIssuesList');
        const quickQuestionsList = document.getElementById('quickQuestionsList');
        const sendToChatBtn = document.getElementById('sendToChatBtn');
        const deeperAnalysisBtn = document.getElementById('deeperAnalysisBtn');
        
        // Handle quick analysis
        quickAnalysisBtn.addEventListener('click', function() {
            const text = quickAnalysisText.value.trim();
            if (!text) {
                alert('Please enter some text to analyze.');
                return;
            }
            
            // Show loading state
            quickAnalysisBtn.disabled = true;
            quickAnalysisBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Analyzing...';
            
            // Call API to analyze text
            fetch('/analyze', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    text: text,
                    mode: quickAnalysisMode.value
                })
            })
            .then(response => response.json())
            .then(data => {
                // Reset button state
                quickAnalysisBtn.disabled = false;
                quickAnalysisBtn.innerHTML = '<i class="bi bi-search"></i> Analyze';
                
                // Display results
                displayQuickResults(data);
            })
            .catch(error => {
                // Reset button state
                quickAnalysisBtn.disabled = false;
                quickAnalysisBtn.innerHTML = '<i class="bi bi-search"></i> Analyze';
                
                console.error('Error analyzing text:', error);
                alert('An error occurred while analyzing the text.');
            });
        });
        
        // Display quick analysis results
        function displayQuickResults(data) {
            // Clear previous results
            quickIssuesList.innerHTML = '';
            quickQuestionsList.innerHTML = '';
            
            // Display issues
            if (data.issues && data.issues.length > 0) {
                const issuesHTML = data.issues.map(issue => `
                    <div class="alert alert-warning">
                        <strong>${issue.issue}:</strong> "${issue.term}" - 
                        <span>${issue.description}</span>
                    </div>
                `).join('');
                
                quickIssuesList.innerHTML = issuesHTML;
            } else {
                quickIssuesList.innerHTML = '<div class="alert alert-success">No issues detected</div>';
            }
            
            // Display questions
            if (data.questions && data.questions.length > 0) {
                const questionsHTML = data.questions.map(question => `
                    <div class="alert alert-info">
                        ${question}
                    </div>
                `).join('');
                
                quickQuestionsList.innerHTML = questionsHTML;
            } else {
                quickQuestionsList.innerHTML = '<div class="alert alert-light">No questions generated</div>';
            }
            
            // Show results section
            quickResults.classList.remove('d-none');
            
            // Store analysis in session storage for other pages
            sessionStorage.setItem('lastAnalysis', JSON.stringify({
                text: data.text,
                issues: data.issues,
                questions: data.questions,
                mode: quickAnalysisMode.value
            }));
        }
        
        // Handle "Continue in Chat" button
        sendToChatBtn.addEventListener('click', function() {
            const lastAnalysis = JSON.parse(sessionStorage.getItem('lastAnalysis') || '{}');
            if (lastAnalysis.text) {
                // Store in session storage for chat page to pick up
                sessionStorage.setItem('chatRedirectText', lastAnalysis.text);
                sessionStorage.setItem('chatRedirectQuestions', JSON.stringify(lastAnalysis.questions || []));
                
                // Redirect to chat page
                window.location.href = '/chat';
            }
        });
        
        // Handle "Deeper Analysis" button
        deeperAnalysisBtn.addEventListener('click', function() {
            const lastAnalysis = JSON.parse(sessionStorage.getItem('lastAnalysis') || '{}');
            if (lastAnalysis.text) {
                // Store in session storage for reflection page to pick up
                sessionStorage.setItem('reflectionRedirectText', lastAnalysis.text);
                
                // Redirect to reflection page
                window.location.href = '/reflection';
            }
        });
        
        // Import Document button
        const importDocumentBtn = document.getElementById('importDocumentBtn');
        importDocumentBtn.addEventListener('click', function() {
            window.location.href = '/multimodal';
        });
        
        // New Session button
        const newSessionBtn = document.getElementById('newSessionBtn');
        newSessionBtn.addEventListener('click', function() {
            // Clear session storage
            sessionStorage.removeItem('lastAnalysis');
            sessionStorage.removeItem('chatRedirectText');
            sessionStorage.removeItem('chatRedirectQuestions');
            sessionStorage.removeItem('reflectionRedirectText');
            
            // Reload page
            window.location.reload();
        });
        
        // Populate system information
        fetch('/api/test')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    document.getElementById('dashboardModelName').textContent = data.model || 'llama3';
                    document.getElementById('dashboardProvider').textContent = data.provider || 'ollama';
                    document.getElementById('dashboardSotStatus').textContent = data.sot_available ? 'Yes' : 'No';
                }
            })
            .catch(error => {
                console.error('Error fetching system information:', error);
            });
    });
</script>
{% endblock %}